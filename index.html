<!DOCTYPE html>
<html>
<head>
  <title>Exercise Logger</title>
  <meta charset="utf-8" />
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; font-size: 2.5em; }
    .step { margin-bottom: 40px; }
    button {
      margin: 10px;
      padding: 25px 45px;
      font-size: 1em;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
      font-size: 0.6em;
    }
    th, td {
      border: 1px solid #888;
      padding: 8px;
      text-align: center;
    }
    th { background-color: #eee; }
    .panel {
      border: 2px solid #ccc;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 30px;
      background: #fafafa;
      font-size: 0.6em;
    }
    .row { display: flex; flex-wrap: wrap; align-items: center; gap: 12px; }
    .row > * { flex: 0 0 auto; }
    select { font-size: 1em; padding: 10px; }
    .pill {
      display: inline-block;
      padding: 8px 14px;
      margin: 4px;
      border-radius: 999px;
      background: #f0f0f0;
      border: 1px solid #ddd;
      font-size: 0.8em;
    }
    .muted { color: #666; }
    .bold { font-weight: bold; }
  </style>
</head>
<body>

  <h1>Exercise Logger</h1>

  <div id="stepContainer" class="step"></div>
  <div id="latestContainer"></div>
  <div id="logTableContainer"></div>

  <script>
    let log = {};
    let mode = null;
    const logs = [];
    const stepContainer = document.getElementById("stepContainer");
    const logTableContainer = document.getElementById("logTableContainer");
    const latestContainer = document.getElementById("latestContainer");

    function getToday() {
      const d = new Date();
      return `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`;
    }

    function renderStep(content) {
      stepContainer.innerHTML = "";
      stepContainer.appendChild(content);
    }

    function createButton(text, onClick) {
      const btn = document.createElement("button");
      btn.textContent = text;
      btn.onclick = onClick;
      return btn;
    }

    function generateRange(start, end, step, unit) {
      let arr = [];
      for (let i = start; i <= end; i += step) arr.push(`${i}${unit}`);
      return arr;
    }

    const LATEST_KEY = "exercise_logger_latest_input";

    function saveLatestInput(entry) {
      const payload = { entry, ts: Date.now() };
      localStorage.setItem(LATEST_KEY, JSON.stringify(payload));
    }

    function loadLatestInput() {
      try {
        const raw = localStorage.getItem(LATEST_KEY);
        if (!raw) return null;
        const payload = JSON.parse(raw);
        const maxAge = 24 * 60 * 60 * 1000;
        if ((Date.now() - payload.ts) > maxAge) {
          localStorage.removeItem(LATEST_KEY);
          return null;
        }
        return payload.entry;
      } catch { return null; }
    }

    function parseSets(sets) {
      if (sets == null) return null;
      if (typeof sets === "number") return sets;
      const m = String(sets).match(/(\d+)/);
      return m ? parseInt(m[1], 10) : null;
    }

    function formatSetsLikeOriginal(oldSets, n) {
      if (typeof oldSets === "number") return n;
      return `${n} set${n === 1 ? "" : "s"}`;
    }

    function incrementSets(sets, delta) {
      const n = parseSets(sets);
      if (n == null) return sets;
      const nn = Math.max(1, n + delta);
      return formatSetsLikeOriginal(sets, nn);
    }

    function parseReps(reps) {
      if (!reps) return null;
      const m = String(reps).match(/(\d+)\s*reps/i);
      if (m) return parseInt(m[1], 10);
      return null;
    }

    function changeRepsValue(reps, delta) {
      const n = parseReps(reps);
      if (n == null) return reps;
      const nn = Math.max(1, n + delta);
      return `${nn} reps`;
    }

    function parseWeightKg(weight) {
      if (!weight) return null;
      const s = String(weight).trim();
      if (!/kg$/i.test(s)) return null;
      const num = parseFloat(s.replace(/kg/i, ""));
      return isNaN(num) ? null : num;
    }

    function adjustWeight(weight, deltaKg) {
      const w = parseWeightKg(weight);
      if (w == null) return weight;
      const nw = Math.max(0, w + deltaKg);
      const hadDecimal = /\d+\.\d+/.test(String(weight));
      const display = hadDecimal ? nw.toFixed(1) : String(Math.round(nw));
      return `${display}kg`;
    }

    function renderLatestInput() {
      latestContainer.innerHTML = "";
      const latest = loadLatestInput();

      const panel = document.createElement("div");
      panel.className = "panel";
      const title = document.createElement("div");
      title.innerHTML = "<div class='bold' style='font-size:1.2em;margin-bottom:10px;'>Input Record (24h)</div>";
      panel.appendChild(title);

      if (!latest) {
        const empty = document.createElement("div");
        empty.className = "muted";
        empty.textContent = "No recent input.";
        panel.appendChild(empty);
        latestContainer.appendChild(panel);
        return;
      }

      const sum = document.createElement("div");
      sum.style.marginBottom = "14px";
      sum.innerHTML = `
        <span class="pill">Date: ${latest.date}</span>
        <span class="pill">Part: ${latest.part}</span>
        <span class="pill">Ex: ${latest.exercise}</span>
        <span class="pill">Eq: ${latest.equipment}</span>
        <span class="pill">W: ${latest.weight}</span>
        <span class="pill">Reps: ${latest.reps}</span>
        <span class="pill">Sets: ${latest.sets}</span>
      `;
      panel.appendChild(sum);

      const row = document.createElement("div");
      row.className = "row";
      row.appendChild(createButton("+1 set", () => {
        const duplicated = { ...latest };
        logs.push(duplicated);
        saveLatestInput(duplicated);
        renderTable(); renderLatestInput();
      }));
      const repsSel = document.createElement("select");
      [1,2,3,4,5].forEach(n => {
        const opt = document.createElement("option");
        opt.value = n;
        opt.textContent = "-" + n;
        repsSel.appendChild(opt);
      });
      const repsBtn = createButton("Reduce reps", () => {
        const delta = -parseInt(repsSel.value, 10);
        const mod = { ...latest, reps: changeRepsValue(latest.reps, delta) };
        logs.push(mod); saveLatestInput(mod); renderTable(); renderLatestInput();
      });
      row.appendChild(repsSel); row.appendChild(repsBtn);

      const repsDeltaSel = document.createElement("select");
      for (let n=-5;n<=5;n++) {
        const opt = document.createElement("option");
        opt.value=n; opt.textContent=n; if(n===0) opt.selected=true;
        repsDeltaSel.appendChild(opt);
      }
      [5,10,20].forEach(n => {
        row.appendChild(createButton("-"+n+"kg", () => {
          const repsDelta = parseInt(repsDeltaSel.value,10)||0;
          const mod = { ...latest, weight: adjustWeight(latest.weight, -n), reps: changeRepsValue(latest.reps, repsDelta) };
          logs.push(mod); saveLatestInput(mod); renderTable(); renderLatestInput();
        }));
      });
      row.appendChild(repsDeltaSel);

      panel.appendChild(row);
      latestContainer.appendChild(panel);
    }

    function start() {
      log = { date:getToday(), weight:"—", reps:"—", sets:"—" };
      const div = document.createElement("div");
      div.innerHTML = "<strong>1. What did you do?</strong><br><br>";
      div.appendChild(createButton("Swim", () => { mode='swim'; log.part="Swim"; log.exercise="—"; log.equipment="Pool"; stepSwim(); }));
      div.appendChild(createButton("Heavy Lift", () => { mode='heavy'; stepBodyPart(); }));
      renderStep(div); renderLatestInput();
    }

    function stepSwim() {
      const div = document.createElement("div");
      div.innerHTML="<strong>Times × 30m</strong><br><br>";
      for(let i=1;i<=12;i++){
        div.appendChild(createButton(i,()=>{ log.reps="30m"; log.sets=i; finalizeLog(); }));
      }
      renderStep(div);
    }

    function stepBodyPart() {
      const div=document.createElement("div");
      div.innerHTML="<strong>Select Body Part</strong><br><br>";
      div.appendChild(createButton("Chest",()=>{ log.part="Chest"; stepChestEquipment(); }));
      div.appendChild(createButton("Back",()=>{ log.part="Back"; stepBackType(); }));
      div.appendChild(createButton("Leg",()=>{ log.part="Legs"; stepLegType(); }));
      renderStep(div);
    }

    function stepBackType() {
      const div=document.createElement("div");
      div.innerHTML="<strong>Back - Type</strong><br><br>";
      div.appendChild(createButton("Machine",()=>{ stepBackGrip("Machine"); }));
      div.appendChild(createButton("Seat Row",()=>{ stepBackGrip("Seat Row"); }));
      renderStep(div);
    }

    function stepBackGrip(equipment) {
      const div=document.createElement("div");
      div.innerHTML=`<strong>${equipment} - Grip</strong><br><br>`;
      ["Normal","Close Grip"].forEach(t=>{
        div.appendChild(createButton(t,()=>{ log.exercise=`${equipment} - ${t}`; log.equipment=equipment; stepWeight(["35kg","42kg","49kg","56kg"]); }));
      });
      renderStep(div);
    }

    function stepChestEquipment() {
      const div=document.createElement("div");
      div.innerHTML="<strong>Chest - Equipment</strong><br><br>";
      div.appendChild(createButton("Dumbbell",()=>{ stepWeight(generateRange(10,30,2,"kg")); log.exercise="Dumbbell"; log.equipment="Dumbbell"; }));
      div.appendChild(createButton("Smith Machine",()=>{ stepWeight(generateRange(20,100,10,"kg")); log.exercise="Smith Press"; log.equipment="Smith Machine"; }));
      div.appendChild(createButton("Cable Machine",()=>{ stepWeight(getChestWeights("Cable Machine")); log.exercise="Cable"; log.equipment="Cable Machine"; }));
      div.appendChild(createButton("Machine",()=>{ stepWeight(["35kg","70kg"]); log.exercise="Machine"; log.equipment="Machine"; }));
      renderStep(div);
    }

    function getChestWeights(eq) {
      if(eq==="Cable Machine") return ["1.1kg","3.4kg","5.7kg","9.0kg","12.5kg","14.7kg","17.0kg","19.3kg","21.6kg","23.8kg","26.2kg","28.4kg","30.6kg"];
      return generateRange(10,30,2,"kg");
    }

    function stepLegType() {
      const div=document.createElement("div");
      div.innerHTML="<strong>Leg - Type</strong><br><br>";
      div.appendChild(createButton("Stretch",()=>{ log.exercise="Stretch"; log.equipment="None"; log.weight="—"; log.reps="—"; log.sets="—"; finalizeLog(); }));
      div.appendChild(createButton("Exercise",()=>{ stepWeight(generateRange(2,20,2,"kg")); log.exercise="Leg"; log.equipment="Dumbbell"; }));
      renderStep(div);
    }

    function stepWeight(weightList){
      const div=document.createElement("div");
      div.innerHTML="<strong>Select Weight</strong><br><br>";
      weightList.forEach(w=>{ div.appendChild(createButton(w,()=>{ log.weight=w; stepReps(); })); });
      renderStep(div);
    }

    function stepReps(){
      const div=document.createElement("div");
      div.innerHTML="<strong>Reps</strong><br><br>";
      for(let i=4;i<=15;i++){
        div.appendChild(createButton(i,()=>{ log.reps=`${i} reps`; log.sets="1 set"; finalizeLog(); }));
      }
      renderStep(div);
    }

    function finalizeLog(){
      logs.push({...log});
      saveLatestInput({...log});
      renderTable(); renderLatestInput(); start();
    }

    function renderTable(){
      const table=document.createElement("table");
      table.innerHTML=`
        <tr><th>Date</th><th>Part</th><th>Exercise</th><th>Equipment</th><th>Weight</th><th>Reps</th><th>Sets</th></tr>
        ${logs.map(e=>`<tr><td>${e.date}</td><td>${e.part}</td><td>${e.exercise}</td><td>${e.equipment}</td><td>${e.weight}</td><td>${e.reps}</td><td>${e.sets}</td></tr>`).join("")}`;
      logTableContainer.innerHTML=""; logTableContainer.appendChild(table);
    }

    start();
  </script>
</body>
</html>
